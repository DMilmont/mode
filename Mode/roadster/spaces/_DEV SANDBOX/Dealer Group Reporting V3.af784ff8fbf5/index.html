<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/18.2.8/css/dx.common.css">
<link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/18.2.8/css/dx.light.css">
<script type="text/javascript" src="https://cdn3.devexpress.com/jslib/18.2.8/js/dx.all.js"></script>
<style>
  .fixed-nav-bar {
    position: fixed;
    top: 0;
    z-index: 9999;
    background-color: white;
    padding: 0;
    box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
  }

  .fixed-nav-bar a {
    padding: 10px;
    display: inline-block;
    font-weight: 500;
    font-size: 13px;
    color: rgb(78, 77, 77);
  }

  .fixed-nav-bar a:hover {
    background-color: #f27802;
    text-decoration: none;
    color: white;
  }

  .has-nav {
    padding-top: 3em;
  }

  @media (max-width: 767px) {
    .fixed-nav-bar {
      position: fixed;
      top: 0;
      z-index: 9999;
      background-color: white;
      padding: 0;
      box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
    }
  }

  .dx-theme-border-color-as-background-color {
    background-color: #fff !important;
    fill: #fff !important;
  }

  * {
    font-family: 'Helvetica Neue', 'Segoe UI', Helvetica, Verdana, sans-serif !important;
    vertical-align: middle !important;
  }
</style>
<div class="row" data-row-height="small">
  <div class="col-md-4">
  </div>
  <div class="col-md-8"></div>
</div>
<div class="row">
  <div class="col-md-12">
    <nav class="fixed-nav-bar">
      <a class="scroll-link" data-id="text_f55f9ebc-1e3c-4b45-b8d4-4b30d8a9620e">Dealer Attributes</a>
      <a class="scroll-link" data-id="text_ea82726d-3f75-4537-d183-094509322169">In-Store Metrics</a>
      <a class="scroll-link" data-id="text_ea82726d-3f75-4537-d183-094509322168">Online Metrics</a>
      <a class="scroll-link" data-id="text_ea82726d-3f75-4537-d183-094509322170">Order Funnel Information</a>
    </nav>
  </div>
</div>
<script>
  // Pull in the Data Group Name for displaying in the title tag
  var data = datasets.filter(function(d) {
    return d.queryName == "Dealer Group Name";
  })[0].content;
  var title = data[0]['Dealer Group']
  $("#title").text(title)
</script>
<div class="mode-header embed-hidden">
  <p></p>
  <h1>
    <span id="title"></span>
  </h1>
  <p>{{ description }}</p>
</div>
<div class="mode-grid container">
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_f55f9ebc-1e3c-4b45-b8d4-4b30d8a9620e" dataset="dataset" options="text_options">
        <h4>Dealer Attributes</h4>
        <p>Find out the specifics about your dealership!</p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-table id="dealer_properties" dataset="dataset" options="table_options"></mode-table>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_ea82726d-3f75-4537-d183-094509322169" dataset="dataset" options="text_options" ,="" class="text">
        <h4>In-Store Metrics</h4>
        <p>Here you can monitor you dealer's In-Store Metrics</p>
        <p><br></p>
      </mode-text>
    </div>
    <div class="row">
      <div class="col-md-12">
        <mode-chart id="chart_355c50431e4c" dataset="dataset" options="chart_options"></mode-chart>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <mode-chart id="in_store_metrics_summ"></mode-chart>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_ea82726d-3f75-4537-d183-094509322168" dataset="dataset" options="text_options">
        <h4>Online Metrics</h4>
        <p><em>Here you can monitor your dealer's Online metrics</em></p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-chart id="chart_c335177d6fcb" dataset="dataset" options="chart_options"></mode-chart>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-chart id="online_metrics_summ"></mode-chart>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_ea82726d-3f75-4537-d183-094509322170" dataset="dataset" options="text_options">
        <h4>Order Metrics</h4>
        <p><em>Here you can understand how customer's are completing order steps</em></p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-chart id="order_funnel_summ"></mode-chart>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_b349214e-9030-49c5-b070-6438779d9aad" dataset="dataset" options="text_options">
        <h4>Agent Certifications Center</h4>
        <p><em>How well do your agents know the product? </em></p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-chart id="agent_certification"></mode-chart>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-table id="table_389ccf2e742d" dataset="dataset" options="table_options"></mode-table>
    </div>
  </div>
</div>
<script>
  var roadsterdx = {
    version: 1,

    getDataSource: function(queryName) {
      // find the right data on the page, by name
      var ii = 0;
      var theSet = null;
      for (ii = 0; ii < datasets.length; ii++) {
        if (datasets[ii].queryName == queryName) {
          theSet = datasets[ii].content;
          break;
        }
      }

      if (!theSet) {
        //console.log('did not find data ' + queryName);
        // make an empty data array
        theSet = [];
      }

      //console.log('returning data');
      return theSet;
      /*
      return new DevExpress.data.DataSource({
        // array of data
        store: theSet,

        // additional configuration options
        // sort: "name",
        // pageSize: 10
      });
      */
    },
  };

  //debugger;
  $(function() {
    var instore = roadsterdx.getDataSource('In-Store Metrics - Daily Data');
    var online = roadsterdx.getDataSource('Online Metrics - Daily Data');
    var order_funnel = roadsterdx.getDataSource('Order Funnel');
    var order_funnel_sum = roadsterdx.getDataSource('Order Funnel - Summarized');
    var dealer_attributes = roadsterdx.getDataSource('Unlock Mode - Today');
    var agent_certs = roadsterdx.getDataSource('Agent Cert Profiles');
    var online_metrics_sum = roadsterdx.getDataSource('Online Metrics - Summarized');
    var instore_metrics_sum = roadsterdx.getDataSource('In-Store Metrics - Summarized');

    $('#pivotContainer1').dxPivotGrid({
      onCellPrepared: function(e) {
        e.cellElement.css('background-color', 'white')
        if (e.cell.value == 0) {
          e.cellElement.css('color', 'white')
        };
        if (e.cell.type == 'GT') {
          e.cellElement.css('background-color', 'black')
          e.cellElement.css('color', 'white')
        };
        if (e.cell.text == 'Grand Total') {
          e.cellElement.css('color', 'white')
          e.cellElement.css('background-color', 'white')
        };
        if (e.cell.type == 'D') {
          e.cellElement.css('background-color', 'white')
          e.cellElement.css('color', 'black')
          e.cellElement.css('text-align', 'center')
        };
      },
      fieldChooser: {
        enabled: false,
        height: 100,
      },
      showRowGrandTotals: false,
      dataSource: {
        store: instore,
        fields: [{
            area: 'row',
            dataField: 'Dealership',
            dataType: 'text',
            width: 150,
            sortOrder: 'desc'
          },
          {
            area: 'data',
            dataField: 'In-Store Prospects',
            caption: 'In-Store Prospects',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'In-Store Orders',
            caption: 'In-Store Orders',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'In-Store Sales',
            caption: 'In-Store Sales',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Active Agents',
            caption: 'Active Agents',
            dataType: 'number',
            summaryType: 'min',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Certified Agents',
            caption: 'Certified Agents',
            dataType: 'number',
            summaryType: 'min',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Activity w/n 3 Days',
            caption: 'Activity w/n 3 Days',
            dataType: 'number',
            summaryType: 'min',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'In-Store Shares',
            caption: 'In-Store Shares',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Prints',
            caption: 'Prints',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Copies',
            caption: 'Copies',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Close Rate',
            caption: 'Close Rate',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
        ],
        retrieveFields: false,
        //      ShowColumnGrandTotals= false,
      }
    });
    // Online Pivot
    $('#pivotContainer2').dxPivotGrid({
      onCellPrepared: function(e) {
        e.cellElement.css('background-color', 'white')
        if (e.cell.value == 0) {
          e.cellElement.css('color', 'white')
        };
        if (e.cell.type == 'GT') {
          e.cellElement.css('background-color', 'black')
          e.cellElement.css('color', 'white')
        };
        if (e.cell.text == 'Grand Total') {
          e.cellElement.css('color', 'white')
          e.cellElement.css('background-color', 'white')
        };
        if (e.cell.type == 'D') {
          e.cellElement.css('background-color', 'white')
          e.cellElement.css('color', 'black')
        };
      },
      fieldChooser: {
        enabled: false,
        height: 100,
      },
      showBorders: true,
      showRowGrandTotals: false,
      dataSource: {
        store: online,
        fields: [{
            area: 'row',
            dataField: 'Dealership',
            dataType: 'text',
            width: 150,
            sortOrder: 'desc'
          },
          {
            area: 'data',
            dataField: 'Dealer Visitors',
            caption: 'Dealer Visitors',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Express Visitors',
            caption: 'Express Visitors',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Online Express Ratio',
            caption: 'Online Express Ratio',
            summaryType: 'avg',
            format: {
              precision: 0,
              type: 'percent'
            }
          },
          {
            area: 'data',
            dataField: 'Prospect Conversion',
            caption: 'Prospect Conversion',
            summaryType: 'avg',
            format: {
              precision: 0,
              type: 'percent'
            }
          },
          {
            area: 'data',
            dataField: 'Online Shares',
            caption: 'Online Shares',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Online Orders',
            caption: 'Online Orders',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
          {
            area: 'data',
            dataField: 'Roadster Matched Sales',
            caption: 'Roadster Matched Sales',
            dataType: 'number',
            summaryType: 'sum',
            format: {
              precision: 0,
            }
          },
        ],
        retrieveFields: false,
      }
    });

    $('#dealer_properties').dxDataGrid({
      dataSource: dealer_attributes,
      onCellPrepared: function(e) {
        if (e.rowType == "header") {
          e.cellElement.css('background', 'black')
        }
      },
      columns: [{
          dataField: 'Dealership',
          caption: 'Rooftop',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">Rooftop</p>'),
          sortOrder: 'desc'
        },
        {
          dataField: 'Price Unlock Mode',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">Price Unlock Mode</p>')
        },
        {
          dataField: 'In-Store Purchase Wizard',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">In-Store Purchase Wizard</p>')
        },
        {
          dataField: 'test_img',
          allowFiltering: false,
          allowSorting: false,
          alignment: 'center',
          cellTemplate: function(container, options) {
            $("<div>")
              .append($("<img>", {
                "src": options.value
              }))
              .appendTo(container);
          },
          headerCellTemplate: $('<p style="color: white">Unlock Type</p>')
        },
        {
          dataField: 'Lead Type',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">Lead Type</p>')
        },
      ],
    });

    $('#agent_certification').dxDataGrid({
      dataSource: agent_certs,
      showBorders: true,
      grouping: {
        autoExpandAll: false
      },
      onCellPrepared: function(e) {
        if (e.rowType == "header") {
          e.cellElement.css('background', 'black')
          e.cellElement.css('color', 'white')
        }
      },
      columns: [{
          dataField: 'Rooftop',
          caption: 'Rooftop',
          alignment: 'center',
          dataType: 'string',
          groupIndex: 0,
          sortOrder: 'desc'
        },
        {
          dataField: 'Agent Name',
          alignment: 'center',
          height: 100,
        },
        {
          dataField: 'Roadster Certifications',
          alignment: 'center'
        },
      ],
      summary: {
        groupItems: [{
            column: 'Agent Name',
            summaryType: 'count',
            displayFormat: '{0} Total Active Agents',
          },
          {
            column: 'Any Roadster Certifications',
            summaryType: 'sum',
            displayFormat: '{0} Total Certifications'
          },
        ]
      },
    });

    $('#online_metrics_summ').dxDataGrid({
      dataSource: online_metrics_sum,
      columnAutoWidth: true,
      wordWrapEnabled: true,
      onCellPrepared: function(e) {
        if (e.rowType == "header") {
          e.cellElement.css('background', 'black')
        };
        if (e.value == 0) {
          e.cellElement.css('color', 'white')
        }
      },
      columns: [{
          dataField: 'Dealership',
          caption: 'Rooftop',
          alignment: 'center',
          dataType: 'string',
          sortOrder: 'desc',
          headerCellTemplate: $('<p style="color: white">Rooftop</p>')
        },
        {
          dataField: 'Dealer Visitors',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Dealer Visitors</p>')
        },
        {
          dataField: 'Express Visitors',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Express Visitors</p>')
        },
        {
          dataField: 'Online Express Ratio',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 2,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Online Express Ratio</p>')
        },
        {
          dataField: 'Prospect Conversion',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 2,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Prospect Conversion</p>')
        },
        {
          dataField: 'Online Shares',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Online Shares</p>')
        },
        {
          dataField: 'Online Orders',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Online Orders</p>')
        },
        {
          dataField: 'Roadster Matched Sales',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Roadster Matched Sales</p>')
        },
        {
          dataField: 'Close Rate',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 2,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Close Rate</p>')
        },
      ],
    });

    // In-Store Data Grid
    $('#in_store_metrics_summ').dxDataGrid({
      dataSource: instore_metrics_sum,
      columnAutoWidth: true,
      wordWrapEnabled: true,
      onCellPrepared: function(e) {
        if (e.rowType == "header") {
          e.cellElement.css('background', 'black')
        };
        if (e.value == 0) {
          e.cellElement.css('color', 'white')
        }
      },
      columns: [{
          dataField: 'Dealership',
          caption: 'Rooftop',
          alignment: 'center',
          dataType: 'string',
          sortOrder: 'desc',
          headerCellTemplate: $('<p style="color: white">Rooftop</p>')
        },
        {
          dataField: 'In-Store Prospects',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">In-Store Prospects</p>')
        },
        {
          dataField: 'In-Store Shares',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">In-Store Shares</p>')
        },
        {
          dataField: 'In-Store Orders',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">In-Store Orders</p>')
        },
        {
          dataField: 'Copies',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0
          },
          headerCellTemplate: $('<p style="color: white">Copies</p>')
        },
        {
          dataField: 'Prints',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Prints</p>')
        },
        {
          dataField: 'In-Store Sales',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">In-Store Sales</p>')
        },
        {
          dataField: 'Close Rate',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Close Rate</p>')
        },
        {
          dataField: 'Active Agents',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Active Agents</p>')
        },
        {
          dataField: 'Certified Agents',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Certified Agents</p>')
        },
        {
          dataField: 'Activity w/n 3 Days',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
          },
          headerCellTemplate: $('<p style="color: white">Activity w/n 3 Days</p>')
        },
      ],
    });

    // Order Funnel Summarized
    $('#order_funnel_summ').dxDataGrid({
      dataSource: order_funnel_sum,
      columnAutoWidth: true,
      wordWrapEnabled: true,
      onCellPrepared: function(e) {
        if (e.rowType == "header") {
          e.cellElement.css('background', 'black')
        };
        if (e.value == 0) {
          e.cellElement.css('color', 'white')
        }
      },
      columns: [{
          dataField: 'Dealership',
          caption: 'Rooftop',
          alignment: 'center',
          dataType: 'string',
          sortOrder: 'desc',
          width: 175,
          headerCellTemplate: $('<p style="color: white">Rooftop</p>')
        },
        {
          dataField: 'Deal Sheet Accepted',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Deal Sheet Accepted</p>')
        },
        {
          dataField: 'Trade-In Completed',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Trade-In Completed</p>')
        },
        {
          dataField: 'Credit Completed',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Credit Completed</p>')
        },
        {
          dataField: 'Service Plans Completed',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Service Plans Completed</p>')
        },
        {
          dataField: 'Accessories Completed Rate',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Accessories Completed Rate</p>')
        },
        {
          dataField: 'Final Deal Sent Rate',
          alignment: 'center',
          dataType: 'number',
          format: {
            precision: 0,
            type: 'percent'
          },
          headerCellTemplate: $('<p style="color: white">Final Deal Sent Rate</p>')
        },
      ],
    });
  });
</script>
<script>
  $(document).ready(function() {
    // navigation click actions
    $('.scroll-link').on('click', function(event) {
      event.preventDefault();
      var sectionID = $(this).attr("data-id");
      scrollToID('#' + sectionID, 750);
    });
    // scroll to top action
    $('.scroll-top').on('click', function(event) {
      event.preventDefault();
      $('html, body').animate({
        scrollTop: 0
      }, 'slow');
    });
    // mobile nav toggle
    $('#nav-toggle').on('click', function(event) {
      event.preventDefault();
      $('#main-nav').toggleClass("open");
    });
  });
  // scroll function
  function scrollToID(id, speed) {
    var offSet = 50;
    var targetOffset = $(id).offset().top - offSet;
    $('html,body').animate({
      scrollTop: targetOffset
    }, speed);
  }
</script>