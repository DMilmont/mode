<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/18.2.8/css/dx.common.css">
<link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/18.2.8/css/dx.light.css">
<link rel="stylesheet" media="screen" href="//d2yvqewjuuy0k6.cloudfront.net/fonts/232352/75E15E124468560E8.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
<script type="text/javascript" src="https://cdn3.devexpress.com/jslib/18.2.8/js/dx.all.js"></script>
<style>
  .fixed-nav-bar {
    position: fixed;
    top: 0;
    z-index: 9999;
    background-color: white;
    padding: 0;
    box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
  }

  .fixed-nav-bar a {
    padding: 10px;
    display: inline-block;
    font-weight: 500;
    font-size: 13px;
    color: rgb(78, 77, 77);
  }

  .fixed-nav-bar a:hover {
    background-color: #f27802;
    text-decoration: none;
    color: white;
  }

  .has-nav {
    padding-top: 3em;
  }

  @media (max-width: 767px) {
    .fixed-nav-bar {
      position: fixed;
      top: 0;
      z-index: 9999;
      background-color: white;
      padding: 0;
      box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
    }
  }

  .dx-theme-border-color-as-background-color {
    background-color: #fff !important;
    fill: #fff !important;
  }

  * {
    /*font-family: 'Helvetica Neue', 'Segoe UI', Helvetica, Verdana, sans-serif !important;*/
    vertical-align: middle !important;
  }
</style>
<div class="row" data-row-height="small">
  <div class="col-md-4">
  </div>
  <div class="col-md-8"></div>
</div>
<script>
  // Pull in the Data Group Name for displaying in the title tag
  var data = datasets.filter(function(d) {
    return d.queryName == "Primary Make Names";
  })[0].content;
  var title = data[0]['Primary Make']
  $("#title").text(title)
</script>
<div class="mode-header embed-hidden">
  <p></p>
  <h1>
    <span id="title"></span>
  </h1>
  <p>{{ description }}</p>
</div>
<div class="mode-grid container">
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_1a38d606-2f60-4f0a-9892-569db3842b15" dataset="dataset" options="text_options">
        <p><strong>TEST</strong> <strong>REPORT</strong> for OEM</p>
        <p>Quick Facts:</p>
        <ol>
          <li>Selecting "Primary Make" will grab all rooftops with that OEM set in our dealer properties. That data will show up under "OEM Rooftop" in our tables below. </li>
          <li>Choose your Date Range is at the Monthly Level. </li>
          <li>"State" can narrow down your Primary Make data to certain areas of the country</li>
          <li>"Dpid" is a new parameter which lets you select custom dealers for comparison. These will show up in the table as "Custom Group". Each table lets you click the arrows to breakout the data at the Rooftop level. </li>
          <li>Each table can be downloaded to excel by clicking the icon on the left. Click the arrows before downloading to get the breakouts of the dataset by rooftop. </li>
        </ol>
        <p><br></p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <mode-chart id="chart_a7eb1e79ccca" dataset="dataset" options="chart_options"></mode-chart>
    </div>
    <div class="col-md-6">
      <mode-chart id="chart_bcf6964646f9" dataset="dataset" options="chart_options"></mode-chart>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_ea82726d-3f75-4537-d183-094509322168" dataset="dataset" options="text_options">
        <h4>Online Metrics</h4>
        <p><em>Here you can monitor your dealer's Online metrics</em></p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-chart id="online_metrics_summ"></mode-chart>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_ea82726d-3f75-4537-d183-094509322169" dataset="dataset" options="text_options" ,="" class="text">
        <h4>In-Store Metrics</h4>
        <p>Here you can monitor you dealer's In-Store Metrics</p>
        <p><br></p>
      </mode-text>
    </div>
    <div class="row">
      <div class="col-md-12">
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <mode-chart id="in_store_metrics_summ"></mode-chart>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_ea82726d-3f75-4537-d183-094509322170" dataset="dataset" options="text_options">
        <h4>Order Metrics</h4>
        <p><em>Here you can understand how customer's are completing order steps</em></p>
      </mode-text>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <mode-chart id="order_funnel_summ"></mode-chart>
    </div>
  </div>
  <!--<div class="row">-->
  <!--  <div class="col-md-12">-->
  <!--    <mode-text id="text_b349214e-9030-49c5-b070-6438779d9aad" dataset="dataset" options="text_options">-->
  <!--      <h4>Agent Certifications Center</h4>-->
  <!--      <p><em>How well do your agents know the product? </em></p>-->
  <!--    </mode-text>-->
  <!--  </div>-->
  <!--</div>-->
  <!--<div class="row">-->
  <!--  <div class="col-md-12">-->
  <!--    <mode-chart id="agent_certification"></mode-chart>-->
  <!--  </div>-->
  <!--</div>-->
  <div class="row">
    <div class="col-md-12">
      <mode-text id="text_f55f9ebc-1e3c-4b45-b8d4-4b30d8a9620e" dataset="dataset" options="text_options">
        <h4>Dealer Attributes</h4>
        <p>Find out the specifics about your dealership!</p>
      </mode-text>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <mode-table id="dealer_properties" dataset="dataset" options="table_options"></mode-table>
    </div>
  </div>
</div>
<script>
  var roadsterdx = {
    version: 1,
    getDataSource: function(queryName) {
      // find the right data on the page, by name
      var ii = 0;
      var theSet = null;
      for (ii = 0; ii < datasets.length; ii++) {
        if (datasets[ii].queryName == queryName) {
          theSet = datasets[ii].content;
          break;
        }
      }
      if (!theSet) {
        //console.log('did not find data ' + queryName);
        // make an empty data array
        theSet = [];
      }
      //console.log('returning data');
      return theSet;
      /*
      return new DevExpress.data.DataSource({
        // array of data
        store: theSet,
        // additional configuration options
        // sort: "name",
        // pageSize: 10
      });
      */
    },
  };
  //debugger;
  $(function() {
    var instore = roadsterdx.getDataSource('In-Store Metrics - Daily Data');
    var online = roadsterdx.getDataSource('Online Metrics - Daily Data');
    var order_funnel_graphic = roadsterdx.getDataSource('Order Funnel - Graphic');
    var order_funnel_sum = roadsterdx.getDataSource('Order Funnel - Summarized');
    var dealer_attributes = roadsterdx.getDataSource('Unlock Mode - Today');
    var agent_certs = roadsterdx.getDataSource('Agent Cert Profiles');
    var online_metrics_sum = roadsterdx.getDataSource('Online Metrics - Summarized');
    var instore_metrics_sum = roadsterdx.getDataSource('In-Store Metrics - Summarized');
    var order_funnel_bar = roadsterdx.getDataSource('Order Funnel - Bar Chart');
    var daily_srp = roadsterdx.getDataSource('Online SRP Data');
    // Generate unique series colors for spline graph
    var dpids = [];
    for (var i = 0; i < daily_srp.length; i++) {
      dpids.push(daily_srp[i]['Dealership']);
    }
    var dpids = [...new Set(dpids)];
    var val_field = []
    for (var i = 0; i < dpids.length; i++) {
      val_field.push({
        valueField: dpids[i]
      });
    };

    $('#online_srp').dxChart({
      palette: 'Harmony Light',
      dataSource: daily_srp,
      title: 'Daily Online SRP Visits',
      commonSeriesSettings: {
        type: 'date',
        argumentField: 'date'
      },
      series: [
        val_field
      ],
    });

    $('#dealer_properties').dxDataGrid({
      dataSource: dealer_attributes,
      filterRow: {
        visible: true
      },
      headerFilter: {
        visible: true
      },
      onCellPrepared: function(e) {
        if (e.rowType == "header") {
          e.cellElement.css('background', 'black')
        }
      },
      masterDetail: {
        enabled: true,
        template: function(container, options) {
          var dlr = options.data['Dealership']
          $("<div>").dxDataGrid({
            dataSource: dealer_attributes.filter(function(x) {
              return (x.Dealership == dlr);
            }),
            columns: [{
              dataField: 'test_img',
              allowFiltering: false,
              allowSorting: false,
              alignment: 'center',
              caption: 'Unlock Form Type',
              cellTemplate: function(container, options) {
                $("<div>")
                  .append($("<img>", {
                    "src": options.value
                  }))
                  .appendTo(container);
              },
            }, ]
          }).appendTo(container);
        },
      },
      columns: [{
          dataField: 'Dealership',
          caption: 'Rooftop',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">Rooftop</p>'),
          sortOrder: 'desc'
        },
        {
          dataField: 'Price Unlock Mode',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">Price Unlock Mode</p>')
        },
        {
          dataField: 'In-Store Purchase Wizard',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">In-Store Purchase Wizard</p>')
        },
        {
          dataField: 'Lead Type',
          alignment: 'center',
          dataType: 'string',
          headerCellTemplate: $('<p style="color: white">Lead Type</p>')
        },
        {
          dataField: 'Go-Live Date',
          alignment: 'center',
          dataType: 'date',
          headerCellTemplate: $('<p style="color: white">Go-Live Date</p>')
        },
        {
          dataField: 'Marketplace Type',
          alignment: 'center',
          dataType: 'date',
          headerCellTemplate: $('<p style="color: white">Marketplace Type</p>')
        },
      ],
    });

    $('#online_metrics_summ').dxPivotGrid({
      allowSortingBySummary: true,
      allowFiltering: true,
      showBorders: true,
      showColumnGrandTotals: false,
      showRowGrandTotals: false,
      showRowTotals: false,
      showColumnTotals: false,
      "export": {
        enabled: true,
        fileName: "online_metrics"
      },
      dataSource: {
        store: online_metrics_sum,
        fields: [{
            dataField: 'custom_grouper',
            caption: 'DataGroups',
            area: 'row',
            width: 120
          },

          {
            dataField: 'Dealership',
            area: 'row',
            width: 125
          },
          {
            dataField: 'Measures',
            area: 'column',
            expanded: true
          },
          {
            dataField: 'Dealer Visitors',
            alignment: 'center',
            dataType: 'number',
            summaryType: 'avg',
            area: 'data',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: 'Express Visitors',
            alignment: 'center',
            dataType: 'number',
            summaryType: 'avg',
            area: 'data',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            caption: "Online Express Ratio",
            area: "data",
            summaryType: "custom",
            calculateSummaryValue: e => {
              if (e.value('Dealer Visitors') == 0) {
                return 0;
              } else {
                return e.value('Express Visitors') / e.value('Dealer Visitors');
              }
            },
            format: {
              precision: 1,
              type: 'percent'
            },
          },
          {
            dataField: 'Online Prospects',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: 'fixedPoint',
              precision: 1
            }
          },
          {
            caption: 'Prospect Conversion %',
            area: 'data',
            summaryType: 'custom',
            calculateSummaryValue: e => {
              if (e.value('Express Visitors') == 0) {
                return 0;
              } else {
                return e.value('Online Prospects') / e.value('Express Visitors');
              }
            },
            format: {
              precision: 1,
              type: 'percent'
            },
          },
          {
            dataField: 'Online Shares',
            area: 'data',
            format: {
              type: 'fixedPoint',
              precision: 1
            },
            summaryType: 'avg'
          },
          {
            dataField: 'Online Orders',
            area: 'data',
            format: {
              type: 'fixedPoint',
              precision: 1
            },
            summaryType: 'avg'
          },
          {
            dataField: 'Roadster Matched Sales',
            area: 'data',
            format: {
              type: 'fixedPoint',
              precision: 1
            },
            summaryType: 'avg'
          },
          {
            caption: 'Close Rate',
            area: 'data',
            format: {
              type: 'percent',
              precision: 1
            },
            summaryType: 'custom',
            calculateSummaryValue: e => {
              if (e.value('Online Prospects') == 0) {
                return 0;
              } else {
                return e.value('Roadster Matched Sales') / e.value('Online Prospects');
              }
            },
          },
        ],
      },
    });
    // In-Store Data Grid
    $('#in_store_metrics_summ').dxPivotGrid({
      allowSortingBySummary: true,
      allowFiltering: true,
      showBorders: true,
      showColumnGrandTotals: false,
      showRowGrandTotals: false,
      showRowTotals: false,
      showColumnTotals: false,
      "export": {
        enabled: true,
        fileName: "instore_metrics"
      },
      dataSource: {
        store: instore_metrics_sum,
        fields: [{
            dataField: 'custom_grouper',
            caption: 'DataGroups',
            area: 'row',
            width: 120
          },

          {
            dataField: 'Dealership',
            area: 'row',
            width: 125
          },
          {
            dataField: 'Measures',
            area: 'column',
            expanded: true
          },
          {
            dataField: "In-Store Prospects",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }

          },
          {
            dataField: "In-Store Shares",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: "In-Store Orders",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: "Copies",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: "Prints",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: "In-Store Sales",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            caption: "Close Rate",
            area: "data",
            summaryType: "custom",
            calculateSummaryValue: e => {
              if (e.value('In-Store Prospects') == 0) {
                return 0;
              } else {
                return e.value('In-Store Sales') / e.value('In-Store Prospects');
              }
            },
            format: {
              precision: 1,
              type: 'percent'
            },
          },
          {
            dataField: "Active Agents",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: "Certified Agents",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: "Activity w/n 3 Days",
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
        ]
      },
    });
    // Order Funnel Summarized
    $('#order_funnel_summ').dxPivotGrid({
      allowSortingBySummary: true,
      allowFiltering: true,
      showBorders: true,
      showColumnGrandTotals: false,
      showRowGrandTotals: false,
      showRowTotals: false,
      showColumnTotals: false,
      "export": {
        enabled: true,
        fileName: "orderstep_metrics"
      },
      dataSource: {
        store: order_funnel_sum,
        fields: [{
            dataField: 'grouper',
            caption: 'DataGroup',
            area: 'row',
            width: 120
          },
          {
            dataField: 'Dealership',
            area: 'row'
          },
          {
            dataField: 'Measures',
            area: 'column',
          },
          {
            dataField: 'Total Orders Submitted',
            caption: 'Total Orders Submitted',
            area: 'data',
            summaryType: 'sum',
            format: {
              type: "fixedPoint",
              precision: 1
            }
          },
          {
            dataField: 'Deal Sheet Accepted Rate',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "percent",
              precision: 1
            }
          },
          {
            dataField: 'Trade-In Completed Rate',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "percent",
              precision: 1
            }
          },
          {
            dataField: 'Credit Completed Rate',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "percent",
              precision: 1
            }
          },
          {
            dataField: 'Service Plans Completed Rate',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "percent",
              precision: 1
            }
          },
          {
            dataField: 'Accessories Completed Rate',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "percent",
              precision: 1
            }
          },
          {
            dataField: 'Final Deal Sent Rate',
            area: 'data',
            summaryType: 'avg',
            format: {
              type: "percent",
              precision: 1
            }
          },
        ]
      },

    });
  });
</script>
<script>
  $(document).ready(function() {
    // navigation click actions
    $('.scroll-link').on('click', function(event) {
      event.preventDefault();
      var sectionID = $(this).attr("data-id");
      scrollToID('#' + sectionID, 750);
    });
    // scroll to top action
    $('.scroll-top').on('click', function(event) {
      event.preventDefault();
      $('html, body').animate({
        scrollTop: 0
      }, 'slow');
    });
    // mobile nav toggle
    $('#nav-toggle').on('click', function(event) {
      event.preventDefault();
      $('#main-nav').toggleClass("open");
    });
  });
  // scroll function
  function scrollToID(id, speed) {
    var offSet = 50;
    var targetOffset = $(id).offset().top - offSet;
    $('html,body').animate({
      scrollTop: targetOffset
    }, speed);
  }
</script>